<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Par_interp__Ast_ann (par_interp@26bb1931b3ad.Par_interp__Ast_ann)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">par_interp@26bb1931b3ad</a> &#x00BB; Par_interp__Ast_ann</nav><h1>Module <code>Par_interp__Ast_ann</code></h1><p>Abstract syntax tree for the annotated parallel version of the while language.</p></header><dl><dt class="spec type" id="type-program_ann"><a href="#type-program_ann" class="anchor"></a><code><span class="keyword">type</span> program_ann</code><code> = </code><table class="variant"><tr id="type-program_ann.Program_ann" class="anchored"><td class="def constructor"><a href="#type-program_ann.Program_ann" class="anchor"></a><code>| </code><code><span class="constructor">Program_ann</span> <span class="keyword">of</span> <span><a href="index.html#type-stmt_ann">stmt_ann</a> list</span> * <a href="index.html#type-stmt_ann">stmt_ann</a> * <span><a href="index.html#type-stmt_ann">stmt_ann</a> list</span></code></td></tr></table></dt><dd><p>In the annotated version we must allow forwards as well as backwards execution, therefore we must implement a doubly-linked list (or rather, its functional equivalent: a zipper) in order to allow movement in both directions.</p><p>In order to explain how a zipper works, let's start from this simple integer list:</p><p><code>[1; 2; 3; 4; 5; 6]</code></p><p>Its zipper representation would consist in a tuple containing:</p><ul><li>A list containing the items to the left of the current element (<code>prev_items</code>);</li><li>The current item (<code>curr_item</code>);</li><li>A list containing the elements to the right of the current element (<code>next_items</code>).</li></ul><p>Therefore, the previous list converted to a zipper would be:</p><p><code>( [], 1, [2; 3; 4; 5; 6] )</code></p><p>A <code>next_item</code> operation</p><ul><li>moves <code>curr_item</code> to the head of <code>prev_items</code> list;</li><li>moves the head of <code>next_items</code> to <code>curr_item</code>.</li></ul><p>Applying <code>next_item</code> to the previous zipper yields</p><p><code>( 1 :: [], 2, [3; 4; 5; 6] )</code></p><p>If we apply <code>next_item</code> two more times, we get</p><p><code>( [3; 2; 1]), 4, [5; 6] )</code></p><p>A <code>prev_item</code> operation</p><ul><li>moves <code>curr_item</code> to the head of <code>next_items</code> list;</li><li>moves the head of <code>prev_items</code> to <code>curr_item</code>.</li></ul><p>Applying <code>prev_item</code> to the last zipper we obtained above yields</p><p><code>( [2; 1]), 3, [4; 5; 6] )</code></p><p>It should be clear at this point that the zipper is the ideal structure that achieves a doubly linked list-like behavior using the functional programming paradigm, allowing us to move in both directions starting from a given list of items (in our case, a list of statements/instructions).</p></dd></dl><dl><dt class="spec type" id="type-stmt_ann"><a href="#type-stmt_ann" class="anchor"></a><code><span class="keyword">and</span> stmt_ann</code><code> = </code><table class="variant"><tr id="type-stmt_ann.Program_start" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Program_start" class="anchor"></a><code>| </code><code><span class="constructor">Program_start</span></code></td></tr><tr id="type-stmt_ann.Program_end" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Program_end" class="anchor"></a><code>| </code><code><span class="constructor">Program_end</span></code></td></tr><tr id="type-stmt_ann.Par_prg_start" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Par_prg_start" class="anchor"></a><code>| </code><code><span class="constructor">Par_prg_start</span></code></td></tr><tr id="type-stmt_ann.Par_prg_end" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Par_prg_end" class="anchor"></a><code>| </code><code><span class="constructor">Par_prg_end</span></code></td></tr><tr id="type-stmt_ann.Skip" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Skip" class="anchor"></a><code>| </code><code><span class="constructor">Skip</span> <span class="keyword">of</span> <span>int list</span></code></td></tr><tr id="type-stmt_ann.Assign" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Assign" class="anchor"></a><code>| </code><code><span class="constructor">Assign</span> <span class="keyword">of</span> <a href="../Par_interp/Ast/index.html#type-int_expr">Par_interp.Ast.int_expr</a> * <a href="../Par_interp/Ast/index.html#type-int_expr">Par_interp.Ast.int_expr</a> * <span>int list</span></code></td><td class="doc"><p>Destructive assignment; 1st <code>int_expr</code> must be <span class="xref-unresolved" title="unresolved reference to &quot;Ast.int_expr.Val&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Ast.int_expr&quot;"><code>Ast</code>.int_expr</span>.Val</span></p></td></tr><tr id="type-stmt_ann.Cadd" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Cadd" class="anchor"></a><code>| </code><code><span class="constructor">Cadd</span> <span class="keyword">of</span> <a href="../Par_interp/Ast/index.html#type-int_expr">Par_interp.Ast.int_expr</a> * <a href="../Par_interp/Ast/index.html#type-int_expr">Par_interp.Ast.int_expr</a> * <span>int list</span></code></td><td class="doc"><p>Constructive assignment (&quot;+=&quot;); must check about 1st <code>int_expr</code> being <span class="xref-unresolved" title="unresolved reference to &quot;Ast.int_expr.Val&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Ast.int_expr&quot;"><code>Ast</code>.int_expr</span>.Val</span></p></td></tr><tr id="type-stmt_ann.Csub" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Csub" class="anchor"></a><code>| </code><code><span class="constructor">Csub</span> <span class="keyword">of</span> <a href="../Par_interp/Ast/index.html#type-int_expr">Par_interp.Ast.int_expr</a> * <a href="../Par_interp/Ast/index.html#type-int_expr">Par_interp.Ast.int_expr</a> * <span>int list</span></code></td><td class="doc"><p>Constructive assignment (&quot;-=&quot;); must check about 1st <code>int_expr</code> being <span class="xref-unresolved" title="unresolved reference to &quot;Ast.int_expr.Val&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Ast.int_expr&quot;"><code>Ast</code>.int_expr</span>.Val</span></p></td></tr><tr id="type-stmt_ann.Par" class="anchored"><td class="def constructor"><a href="#type-stmt_ann.Par" class="anchor"></a><code>| </code><code><span class="constructor">Par</span> <span class="keyword">of</span> <a href="index.html#type-program_ann">program_ann</a> * <a href="index.html#type-program_ann">program_ann</a> * int * <span>int list</span></code></td></tr></table></dt><dd><p>Statements must be annotated as well with the following additions:</p><ol><li><code>Program_start</code> and <code>Program_end</code>, in order to set boundaries for the whole program;</li><li><code>Par_prg_start</code> and <code>Par_prg_end</code>, in order to set boundaries for programs contained inside the <code>Par</code> statements;</li><li>An <code>int list</code> for each statement (except for boundary-tracking statements), in order to keep track of the statements' execution order;</li><li>An <code>int</code> value for the <code>Par</code> statement, used to keep track of how many child threads containing the two programs are done with their execution (values' range: 0-2).</li></ol><p>As for 3), a scalar would probably have sufficed instead of a list since we aren't using any loops in the parallel version (and therefore no statement can be executed more than once), however we're using a list anyway in case we decide to add loops as well later on.</p></dd></dl></div></body></html>